{% extends 'layouts/base.html' %}
{% load static %}
{% load compress %}
{% block extracss %}
    <link rel="stylesheet" href="/static/css/dashboard.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.3/dist/leaflet.css"
    integrity="sha256-kLaT2GOSpHechhsozzB+flnD+zUyjE2LlfWPgU04xyI="
    crossorigin=""/>
{% endblock %}

{% block extrajs %}
    <script src="/static/lib/echarts/echarts.js" charset="utf-8"></script>
    <script src="https://unpkg.com/leaflet@1.9.3/dist/leaflet.js"
     integrity="sha256-WBkoXOwTeyKclOHuWtc+i2uENFpDZ9YPdf5Hf+D7ewM="
     crossorigin=""></script>
     <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
{% endblock %}

{% block body_alert %}
    {% if accountCreated == True %}
        <div class="container-fluid justify-content-center mt-2">
            <div class="alert alert-success alert-dismissible text-center balise-infos" role="alert">
                Votre compte a bien été créé !
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            </div>
        </div>
    {% endif %}
{% endblock %}

{% block body_content %}

{% csrf_token %}

{% comment %}
<div class="btn-group dimension-display" role="group" aria-label="Selection of display graph mode 2D or 3D" onchange="flipDimensionDisplay()">
    <input type="radio" class="btn-check" name="btnradio" id="btn2D" autocomplete="off"  checked>
    <label class="btn btn-outline-primary" for="btn2D">2D</label>

    <input type="radio" class="btn-check" name="btnradio" id="btn3D" autocomplete="off">
    <label class="btn btn-outline-primary" for="btn3D">3D</label>
</div>

<div class="switch-accordeon">
    <div class="form-check form-switch">
        <input class="form-check-input" type="checkbox" value="" id="fixedSources" onclick="fixedAccordeon(this)" checked>
        <label class="form-check-label" for="fixedSources">
            Affichage fixe
        </label>
    </div>
</div>
{% endcomment %}
<div class="midas-container container-fluid" id="midas-container-advanced">
    <p class="h1 title">Dashboard</p>
    <div class="accordion" id="accordionDashboard0" hidden>
        <h4 id="title0">Données : filtre 0</h4>
        <div class="accordion-item">
            <h2 class="accordion-header" id="headingSources0">
                <button id="buttonSources0" class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSources0" aria-expanded="true" aria-controls="collapseSources">
                    Sources
                </button>
            </h2>
            <div id="collapseSources0" class="accordion-collapse collapse show" aria-labelledby="headingSources">
                <div class="accordion-body sources">
                    {% for source in sources %}
                        <div class="form-check form-check-inline">
                            <input class="form-check-input" type="checkbox" value="{{ source.slug }}" id="flexCheck{{ source.slug }}0" onclick="select_source(this, 0)">
                            <label class="form-check-label" for="flexCheck{{ source.slug }}0">
                                {{ source.name }}
                            </label>
                        </div>
                    {% endfor %}
                </div>
            </div>
        </div>
        <div class="accordion-item">
            <h2 class="accordion-header" id="headingStations0">
                <button id="buttonStations0" class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseStations0" aria-expanded="false" aria-controls="collapseStations" disabled>
                    Stations
                </button>
            </h2>
            <div id="collapseStations0" class="accordion-collapse collapse" aria-labelledby="headingStations">
                <div class="accordion-body stations" id="accordionStations0">

                </div>
            </div>
        </div>
        <div class="accordion-item">
            <h2 class="accordion-header" id="headingParameters0">
                <button id="buttonParameters0" class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseParameters0" aria-expanded="false" aria-controls="collapseParameters" disabled>
                    Paramètres
                </button>
            </h2>
            <div id="collapseParameters0" class="accordion-collapse collapse" aria-labelledby="headingParameters">
                <div class="accordion-body parameters" id="accordionParameters0">

                </div>
            </div>
        </div>
        <div class="accordion-item">
            <h2 class="accordion-header" id="headingDates0">
                <button id="buttonDates0" class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseDates0" aria-expanded="false" aria-controls="collapseDates" disabled>
                    Couverture Temporelle
                </button>
            </h2>
            <div id="collapseDates0" class="accordion-collapse collapse" aria-labelledby="headingDates">
                <div class="needs-validation">
                    <div class="accordion-body dates" id="accordionDates0">
                        <div class="row align-items-center justify-content-center starting-date">
                            <div class="col-sm-3">
                                <label for="startingDate0">Date de début  :</label>
                            </div>
                            <div class="col-sm-6">
                                <input type="datetime-local" id="startingDate0" name="starting_date" class="form-control" required="">
                            </div>
                        </div>
                        <div class="row align-items-center justify-content-center ending-date">
                            <div class="col-sm-3">
                                <label for="endingDate0">Date de fin  :</label>
                            </div>
                            <div class="col-sm-6">
                                <input type="datetime-local" id="endingDate0" name="ending_date" class="form-control" required="">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <span class="delete-search" onclick="removeResearch(this, 0)">
            <i class="fa-solid fa-circle-xmark"></i>
        </span>
    </div>

    <div id="addResearchDiv"></div>

    <div class="addResearch" id="addResearchButton" onclick="addResearch()">Ajouter une recherche (1/2)<i class="fa-solid fa-circle-plus"></i></div>

    <div class="submit-data-dashboard">
        <button type="submit" id="downloadButton" class="btn btn-dark" onclick="requestData(false)" disabled>
            Télécharger
        </button>
        <button type="submit" id="submitButton" class="btn btn-primary" onclick="requestData()" disabled>
            Visualiser
        </button>
    </div>

    <div id="displayAdvanced">

        <div class="" id="EchartsParameters">
        </div>

        <div id="loader" class=""></div>

        <div id="error-dashboard-message" class="alert alert-danger text-center balise-infos" role="alert" hidden>
            Une erreur est survenue lors du chargement des données
        </div>

        <div class="d-flex w-100 justify-content-center" id="echarts">
            <div id="mainAdvanced" class="d-none" width="100%" height="800px" style="width: 100%; height: 800px;"></div>
        </div>
    </div>

</div>

<div class="midas-container-map" id="midas-container-map">
    <div id="map">
        <div id="map-menu">
            <div id="search-bar" class="input-group rounded">
                <input type="search" id="searchBar" class="form-control" placeholder="Recherche" autocomplete="off" autofocus />
                <div class="card" hidden>
                    <ul id="cardResultsList" class="list-group list-group-flush">
                        <li class="list-group-item">An item</li>
                    </ul>
                </div>
                <button type="button" id="magnifyingButtonId" class="btn btn-light search-btn search-btn-glass" onclick="keyIputSearch()">
                    <i id="magnifyingId" class="fa-solid fa-magnifying-glass"></i>
                </button>
                <span class="divider"></span>
                <button type="button" class="btn btn-light search-btn search-btn-chart" onclick="openMapMenu()">
                    <i class="fa-solid fa-chart-simple"></i>
                </button>
            </div>
            <div id="badges-recap">
            </div>
            <div id="extension-chevron" class="extension-chevron">
                <button type="button" class="btn btn-light" onclick="synchronizeButtonCollapseAndMarkers()">
                    <i class="fas fa-chevron-circle-right"></i>
                </button>
            </div>
            <div class="layer-over-search">
                <div class="collapse collapse-horizontal" id="collapseWidthExample">
                    <div class="card card-body">
                        <div class="card-map-stations">
                            <h2>Stations :</h2>
                            <div id="burger-map-stations">Aucune station sélectionnée...</div>
                        </div>
                        <div class="card-map-parameters">
                            <h2>Paramètres :</h2>
                            <div id="burger-map-parameters">Aucun paramètre sélectionné...</div>
                        </div>
                        <div class="card-map-temporality" id="card-map-temporality">
                            <h2>Temporalité :</h2>
                            <label for="startingDateMap">Date de début :</label>
                            <input type="datetime-local" id="startingDateMap" name="starting_date_map" class="form-control" oninput="updateDateMap(this.value, 1)" required="">
                            <label for="endingDateMap" style="margin-top: 1em;">Date de fin :</label>
                            <input type="datetime-local" id="endingDateMap" name="ending_date_map" class="form-control" oninput="updateDateMap(this.value, 0)" required="">
                        </div>
                        <div class="display-btn-data-map" id="display-btn-data-map">
                            <button id="displayButton" type="button" class="btn btn-primary" onclick="" disabled>Visualiser</button>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal fade" id="displayModal" tabindex="-1" aria-labelledby="displayModalLabel" aria-hidden="true">
                <div class="modal-dialog">
                  <div class="modal-content">
                    <div class="modal-header">
                      <h5 class="modal-title" id="displayModalLabel">Graphe de données</h5>
                      <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body" id="displayMap">

                        <div class="" id="EchartsParametersMap">
                        </div>
                
                        <div id="loaderMap" class=""></div>
                
                        <div id="error-dashboard-message" class="alert alert-danger text-center balise-infos" role="alert" hidden>
                            Une erreur est survenue lors du chargement des données
                        </div>
                
                        <div class="" id="displayMainMap" style="width: 100%; height: 70vh; margin: auto;">
                            <div id="mainMap" style="width: 100%; height: 70vh; margin: auto;"></div>
                        </div>
                    </div>
                  </div>
                </div>
              </div>
        </div>
    </div>
</div>

<div id="advanced-map-selection">
    <button type="button" class="btn btn-outline-primary" onclick="handleAdvancedOrMap(this)">Avancé</button>
</div>

{% compress js inline %}
    <script type="text/javascript">
        var idx = 1;
        var array_current_idx = [];
    </script>

    <script type="text/javascript" src="{% static 'js/dashboard/variables.js' %}"></script>
    <script type="text/javascript" src="{% static 'js/dashboard/utils.js' %}"></script>
    <script type="text/javascript" src="{% static 'js/dashboard/displayData.js' %}"></script>
    <script type="text/javascript" src="{% static 'js/dashboard/getData.js' %}"></script>
    <script type="text/javascript" src="{% static 'js/dashboard/map.js' %}"></script>
    <script type="text/javascript" src="{% static 'js/dashboard/advanced.js' %}"></script>
{% endcompress %}

<script type="text/javascript">

    // var sources = ['climacity'];
    // var stations = ['prairie'];
    // var parameters = ['tamb_avg'];
    // var start_date = '2022-05-08 00:00:00';
    // var end_date = '2022-05-08 23:59:59';

    // const csrf = document.querySelector('input[name="csrfmiddlewaretoken"]').value
    function test(){
        fetch('/api/search/',{
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': csrf,
                'Authorization': "Midas admin :1[YLC!DL]}id<Ip*@Pc"
            },
            body: JSON.stringify({
                'sources': sources,
                'stations': stations,
                'parameters': parameters,
                'start_date': start_date,
                'end_date': end_date
            })
        })
        .then(function(response) {
            return response.json();
        })
        .then(function(myBlob) {
            //console.log(myBlob)
            console.log()
        });
    }
    // test();
</script>

{% endblock %}
