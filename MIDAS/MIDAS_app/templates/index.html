{% extends 'layouts/base.html' %}
{% load static %}
{% block extracss %}
    <link rel="stylesheet" href="/static/css/dashboard.css">
{% endblock %}

{% block extrajs %}
    <script src="/static/lib/echarts/echarts.js" charset="utf-8"></script>
{% endblock %}

{% block body_content %}

{% csrf_token %}


<p class="h1 title">Dashboard</p>

<div class="switch-accordeon">
    <div class="form-check form-switch">
        <input class="form-check-input" type="checkbox" value="" id="fixedSources" onclick="fixedAccordeon(this)" checked>
        <label class="form-check-label" for="fixedSources">
            Affichage fixe
        </label>
    </div>
</div>

<div class="midas-container container-fluid">
    <div class="accordion" id="accordionDashboard">
        <div class="accordion-item">
            <h2 class="accordion-header" id="headingSources">
                <button id="buttonSources" class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSources" aria-expanded="true" aria-controls="collapseSources">
                    Sources
                </button>
            </h2>
            <div id="collapseSources" class="accordion-collapse collapse show" aria-labelledby="headingSources">
                <div class="accordion-body sources">
                    {% for source in sources %}
                        <div class="form-check form-check-inline">
                            <input class="form-check-input" type="checkbox" value="{{ source.slug }}" id="flexCheck{{ source.slug }}" onclick="select_source(this)">
                            <label class="form-check-label" for="flexCheck{{ source.slug }}">
                                {{ source.name }}
                            </label>
                        </div>
                    {% endfor %}
                </div>
            </div>
        </div>
        <div class="accordion-item">
            <h2 class="accordion-header" id="headingStations">
                <button id="buttonStations" class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseStations" aria-expanded="false" aria-controls="collapseStations" disabled>
                    Stations
                </button>
            </h2>
            <div id="collapseStations" class="accordion-collapse collapse" aria-labelledby="headingStations">
                <div class="accordion-body stations" id="accordionStations">
                    
                </div>
            </div>
        </div>
        <div class="accordion-item">
            <h2 class="accordion-header" id="headingParameters">
                <button id="buttonParameters" class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseParameters" aria-expanded="false" aria-controls="collapseParameters" disabled>
                    Paramètres
                </button>
            </h2>
            <div id="collapseParameters" class="accordion-collapse collapse" aria-labelledby="headingParameters">
                <div class="accordion-body parameters" id="accordionParameters">
                    
                </div>
            </div>
        </div>
        <div class="accordion-item">
            <h2 class="accordion-header" id="headingDates">
                <button id="buttonDates" class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseDates" aria-expanded="false" aria-controls="collapseDates" disabled>
                    Temporalité
                </button>
            </h2>
            <div id="collapseDates" class="accordion-collapse collapse" aria-labelledby="headingDates">
                <div class="needs-validation">
                    <div class="accordion-body dates" id="accordionDates">
                        <div class="row align-items-center justify-content-center starting-date">
                            <div class="col-sm-3">
                                <label for="id_starting_date">Date de début  :</label>
                            </div>
                            <div class="col-sm-6">
                                <input type="datetime-local" id="startingDate" name="starting_date" class="form-control" required="" id="id_starting_date">
                            </div>
                        </div>
                        <div class="row align-items-center justify-content-center ending-date">
                            <div class="col-sm-3">
                                <label for="id_ending_date">Date de fin  :</label>
                            </div>
                            <div class="col-sm-6">
                                <input type="datetime-local" id="endingDate" name="ending_date" class="form-control" required="" id="id_ending_date">
                            </div>
                        </div>
                
                        <div class="submit-data-dashboard">
                            <button type="submit" class="btn btn-primary" onclick="requestData(this)">
                                Envoyer
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="addResearchDiv"></div>

    <div class="addResearch" onclick="addResearch()">Ajouter une recherche <i class="fas fa-plus-circle"></i></div>

    <div class="" id="EchartsParameters">
    </div>

    <div class="d-flex w-100 justify-content-center" id="echarts">
        <div id="main" class="d-none" style="width: 100%;height:800px;"></div>
    </div>

</div>

<script type="text/javascript">
    function addResearch(){
        console.log("Pouet");
    }

</script>

<script type="text/javascript" src="{% static 'js/dashboard.js' %}"></script>

<script type="text/javascript">

    {% comment %} var sources = ['climacity'];
    var stations = ['prairie'];
    var parameters = ['tamb_avg'];
    var start_date = '2022-05-08 00:00:00';
    var end_date = '2022-05-08 23:59:59'; {% endcomment %}

    // const csrf = document.querySelector('input[name="csrfmiddlewaretoken"]').value
    function test(){
        fetch('/api/search/',{
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': csrf,
                'Authorization': "Midas admin :1[YLC!DL]}id<Ip*@Pc"
            },
            body: JSON.stringify({
                'sources': sources,
                'stations': stations,
                'parameters': parameters,
                'start_date': start_date,
                'end_date': end_date
            })
        })
        .then(function(response) {
            return response.json();
        })
        .then(function(myBlob) {
            //console.log(myBlob)
            console.log()
        });
    }
    // test();
</script>

{% endblock %}
