{% extends 'layouts/base.html' %}
{% block body_content %}
<div class="midas-container container-fluid">
    <div class="alert alert-danger text-center" role="alert">
        Site en construction !
    </div>
    <div class="h1">Gestion de Données</div>
    {% if user.is_superuser %}
    <div>
        <form class="row align-items-end g-3 needs-validation" action="/harvest-data/" method="post">
            <div class="h4">Ajout de données</div>
            <div class="subtitle fst-italic">Ajoute les données pour toutes les sources actuellement</div>
            {% csrf_token %}
            {{ form.non_field_errors }}
            <div class="col-md-4">
                <label for="{{ form.starting_date.id_for_label }}">{{ form.starting_date.label }} :</label>
                {{ form.starting_date }}
            </div>
            <div class="col-md-4">
                <label for="{{ form.ending_date.id_for_label }}">{{ form.ending_date.label }} :</label>
                {{ form.ending_date }}
            </div>
            <div class="col-md-4">
                <button type="submit" onclick="displayRunner(this)" class="btn btn-primary">
                    <span class="spinner-border spinner-border-sm" role="status" aria-hidden="true" hidden></span>
                    Envoyer
                </button>
            </div>
        </form>
    </div>
    {% endif %}
    <div class="mt-5 h4">Téléchargement de fichiers</div>
    <div class="subtitle fst-italic">Télécharge le fichier complet actuellement</div>
    <nav aria-label="breadcrumb">
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a href="/manage-data/">Media</a></li>
            {% if origin != '' %}
                <li class="breadcrumb-item"><a href="/manage-data/?origin={{ origin }}">{{ origin }}</a></li>
            {% endif %}
            {% if source != '' %}
                <li class="breadcrumb-item">{{ source }}</li>
            {% endif %}
        </ol>
      </nav>

    <ul>
    {% for key, value in file.items %}
        {% if value %}
            <li>
                <form action="/manage-data/" method="post">
                    <i class="fas fa-file"></i> {{ key }}
                    {% csrf_token %}
                    <input type="hidden" id="filename" name="filename" value="{{ key }}">
                    <input type="hidden" id="origin" name="origin" value="{{ origin }}">
                    <input type="hidden" id="source" name="source" value="{{ source }}">
                    <button class="btn btn-success">Télécharger le fichier</button>
                </form>
            </li>
        {% else %}
            <a href="{{ path_redirect }}{{ key }}"><li><i class="fas fa-folder"></i> {{ key }}</li></a>
        {% endif %}
    {% endfor %}
    </ul>
</div>

<script>
    function displayRunner(e) {
        //console.log(e.firstElementChild)
        var starting_date = document.getElementById('id_starting_date').value;
        var ending_date = document.getElementById('id_ending_date').value;
        if (starting_date != '' && ending_date != ''){
            e.firstElementChild.hidden = false;
        }
    }
</script>

{% endblock %}
